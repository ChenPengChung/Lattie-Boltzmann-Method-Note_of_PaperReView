\documentclass[12pt]{article}
\usepackage[a4paper,margin=2cm]{geometry} % 明確設定四邊
\usepackage{fontspec} % 字體設定
\usepackage{xeCJK}
\usepackage{setspace} % 設定行距
\linespread{1.2}
\usepackage{titling} % 預設標題下移0.6in
\usepackage{enumitem}
\usepackage{amsmath} % 數學方程式
\usepackage{graphicx} %圖片
\usepackage{float} % 在導言區，讓圖片強制插在原地
\usepackage{xcolor} %字體加入顏色
\usepackage{listings}
\usepackage{physics} % 物理符號
\usepackage{wrapfig} % 文字環繞圖
\usepackage{array} % 表格對齊控制
\usepackage{caption}
\usepackage{amsthm}
\usepackage{tabularx}
\usepackage{booktabs}
\usepackage{multirow}
\usepackage{etoolbox}
\usepackage{titlesec}
\usepackage{tocloft}
\usepackage{hyperref}
\usepackage{makecell}
\usepackage{xcolor}
\usepackage{colortbl}
\hypersetup{
  colorlinks=true,
  linkcolor=blue,
  urlcolor=blue,
  citecolor=blue,
  linktoc=all
}
\usepackage{tcolorbox}
\tcbuselibrary{skins,breakable}
\usepackage{tikz}
\usetikzlibrary{arrows.meta,positioning,shapes.geometric}
\tcbset{
  highlightblock/.style={
    enhanced,
    breakable,
    colback=gray!8,
    colframe=gray!60,
    boxrule=0.4pt,
    arc=0pt,
    boxsep=0pt,
    left=4pt,
    right=4pt,
    top=4pt,
    bottom=4pt,
    before skip=0pt,
    after skip=0pt
  }
}
\usepackage{longtable}

%1 註記行距設定
\setlist[itemize]{itemsep=1.2pt, parsep=0pt, topsep=1pt}
\setlist[enumerate]{itemsep=1.2pt, parsep=0pt, topsep=1pt}
%2 圖表標題設定
\captionsetup{
    labelfont={footnotesize,bf},    % 標籤：小字體+粗體
    skip=10pt                        % 標題與圖表的間距
}
%3 表格間距設定
\setlength{\tabcolsep}{8pt} % 列間距（增加）
\renewcommand{\arraystretch}{1.4} % 行間距（增加）
%4 腳註設定
\usepackage[bottom,hang]{footmisc} % 腳註置於頁面底部，懸掛縮排
\setlength{\footnotesep}{10pt} % 腳註之間的間距（增加）
\setlength{\skip\footins}{12pt plus 5pt minus 2pt} % 正文與腳註之間的間距（增加）
\setlength{\footnotemargin}{1.5em} % 腳註標號與文字的間距（增加）
\renewcommand{\footnoterule}{\vspace*{-3pt}\hrule width 0.4\columnwidth height 0.4pt\vspace*{3pt}} % 腳註分隔線
%5 使用直立字體的定理樣式
\newtheoremstyle{upright}
  {6pt}{6pt}  % 定理環境前後間距（增加）
  {\normalfont}% 使用正常字體，不使用斜體
  {0pt}{\bfseries}{：}{0.5em}{}
%6 定理環境定義
\theoremstyle{upright}
\newtheorem{definition}{定義}[section]
\newtheorem{theorem}{定理}[section]
\newtheorem{lemma}{引理}[section]
\newtheorem{corollary}{推論}[section]
\newtheorem{example}{例子}[section]
% 重新正確定義 remark 環境 - 確保完全靠左對齊
\makeatletter
\@ifundefined{c@remark}{}{\renewcommand{\theremark}{}}
\newenvironment{remark}{%
  \par\vspace{0.0\baselineskip}%
  \begingroup% 開始一個組以限制設置的範圍
  \setlength{\parindent}{0pt}% 設置段落縮進為零
  \setlength{\leftskip}{0pt}% 設置左邊距為零
  \noindent\textbf{註記：}\\% 添加標題並強制換行
  \ignorespaces% 忽略可能的空格
  \setlist[enumerate]{itemsep=0pt, parsep=0pt, topsep=0.0pt, leftmargin=1.5em}%
  \setlist[itemize]{itemsep=0pt, parsep=0pt, topsep=0.0pt, leftmargin=1.5em}%
}{%
  \endgroup% 結束組
  \par\vspace{0.5\baselineskip}
}
\makeatother
%7 手動定義中文數字（不含標點符號）
\newcommand{\chinese}[1]{%
  \ifcase#1 零\or 一\or 二\or 三\or 四\or 五\or 六\or 七\or 八\or 九\or 十\or
  十一\or 十二\or 十三\or 十四\or 十五\or 十六\or 十七\or 十八\or 十九\or 二十\fi
}

%8 重新定義章節編號格式
\renewcommand{\thesection}{\chinese{\value{section}}}
\renewcommand{\thesubsection}{\chinese{\value{section}}、\arabic{subsection}}
\renewcommand{\theequation}{\chinese{\value{section}}.\arabic{equation}}
\renewcommand{\thesubsubsection}{\chinese{\value{section}}、\arabic{subsection}.\arabic{subsubsection}}
\renewcommand{\thefigure}{\chinese{\value{section}}.\arabic{figure}}
\renewcommand{\thedefinition}{\thesection、\arabic{definition}}
\renewcommand{\thetheorem}{\thesection、\arabic{theorem}}
\renewcommand{\theexample}{\thesection、\arabic{example}}

% 为不同级别的标题增加编号后的空格
\setlength{\cftsecnumwidth}{2.5em}  % section 编号宽度
\setlength{\cftsubsecnumwidth}{3.5em}  % subsection 编号宽度
\setlength{\cftsubsubsecnumwidth}{4.5em}  % subsubsection 编号宽度

% 添加点线（可选）
\renewcommand{\cftsubsubsecleader}{\cftdotfill{\cftdotsep}}
\renewcommand{\cftsubsecleader}{\cftdotfill{\cftdotsep}}
\renewcommand{\cftsecleader}{\cftdotfill{\cftdotsep}}
%9 讓方程式計數器在每個section重置
\counterwithin{equation}{section}
%10 字體設定 - 優化以減少警告
\IfFontExistsTF{Times New Roman}{%
  \setmainfont{Times New Roman}%
}{%
  \setmainfont{TeX Gyre Termes}%
}

%\setCJKmainfont[
%    BoldFont={Kaiti TC Bold},
%    ItalicFont={Kaiti TC},
%    BoldItalicFont={Kaiti TC Bold}
%]{Kaiti TC}
%\setCJKmonofont{Kaiti TC}
\IfFontExistsTF{DFKai-SB}{%
  \setCJKmainfont[
    BoldFont={DFKai-SB},
    ItalicFont={DFKai-SB},
    BoldItalicFont={DFKai-SB}
  ]{DFKai-SB}%
  % 為 xeCJK 明確指定等寬字型以消除 \CJKttdefault 警告
  \setCJKmonofont{DFKai-SB}%
}{%
  \IfFontExistsTF{Kaiti TC}{%
    \setCJKmainfont[
      BoldFont={Kaiti TC Bold},
      ItalicFont={Kaiti TC},
      BoldItalicFont={Kaiti TC Bold}
    ]{Kaiti TC}%
    % 為 xeCJK 明確指定等寬字型以消除 \CJKttdefault 警告
    \setCJKmonofont{Kaiti TC}%
  }{%
    \IfFontExistsTF{Songti TC}{%
      \setCJKmainfont{Songti TC}%
      % 為 xeCJK 明確指定等寬字型以消除 \CJKttdefault 警告
      \setCJKmonofont{Songti TC}%
    }{%
      \setCJKmainfont{Heiti TC}%
      % 為 xeCJK 明確指定等寬字型以消除 \CJKttdefault 警告
      \setCJKmonofont{Heiti TC}%
    }%
  }%
}
%11 標題設定
\setlength{\droptitle}{-1in} % 上移標題1in
\title{LES\_LBM}
\author{Chen Peng Chung}
\setcounter{section}{0}
% 12调整 subsection 的间距
\titlespacing*{\section}
{0pt}                    % 左边距
{0.0in}                 % 标题前间距
{0.0em}                  % 标题后间距
\titlespacing*{\subsection}
{0pt}                    % 左边距
{-0.05in}                % 标题前间距
{0.0em}                  % 标题后间距
% 调整 subsubsection 的间距  
\titlespacing*{\subsubsection}
{0pt}                    % 左边距
{0.0in}                 % 标题前间距
{0.0em}                  % 标题后间距
%13.

% ========== Monokai Light 配色方案（淺灰背景）==========
\definecolor{monokailight-bg}{RGB}{240,240,240}      % 淺灰背景 #F0F0F0
\definecolor{monokailight-fg}{RGB}{39,40,34}         % 深色文字 #272822
\definecolor{monokailight-comment}{RGB}{117,113,94}  % 註解 #75715E
\definecolor{monokailight-string}{RGB}{152,118,24}   % 字串 #987618
\definecolor{monokailight-keyword}{RGB}{244,0,95}    % 關鍵字 #F4005F
\definecolor{monokailight-function}{RGB}{121,162,0}  % 函數 #79A200
\definecolor{monokailight-number}{RGB}{137,89,168}   % 數字 #8959A8
\definecolor{monokailight-type}{RGB}{0,129,152}      % 型別 #008198
\definecolor{monokailight-operator}{RGB}{244,0,95}   % 運算符 #F4005F
\definecolor{monokailight-border}{RGB}{210,210,210}  % 邊框 #D2D2D2

% ========== CUDA 語言定義 ==========
\lstdefinelanguage{CUDA}{
    language=C++,
    morekeywords={__global__, __device__, __host__, __shared__, 
                  __constant__, __syncthreads, dim3, cudaMalloc,
                  cudaMemcpy, cudaFree, cudaMemcpyHostToDevice,
                  cudaMemcpyDeviceToHost, cudaDeviceSynchronize},
    % 型別關鍵字
    morekeywords=[2]{double, float, int, char, void, size_t,
                     uint, uint2, uint3, uint4,
                     int2, int3, int4,
                     float2, float3, float4,
                     double2, double3, double4},
    % CUDA 內建變數
    morekeywords=[3]{blockIdx, threadIdx, blockDim, gridDim,
                     warpSize},
    sensitive=true
}

% ========== Monokai Light 樣式 ==========
\lstdefinestyle{monokailight}{
    language=CUDA,
    backgroundcolor=\color{monokailight-bg},
    basicstyle=\color{monokailight-fg}\ttfamily\footnotesize,
    commentstyle=\color{monokailight-comment}\itshape,
    keywordstyle=\color{monokailight-keyword}\bfseries,
    keywordstyle=[2]\color{monokailight-type}\bfseries,      % 型別
    keywordstyle=[3]\color{monokailight-function}\bfseries,  % CUDA 變數
    stringstyle=\color{monokailight-string},
    numberstyle=\tiny\color{monokailight-comment},
    % 數字顏色
    literate=
        {0}{{{\color{monokailight-number}0}}}1
        {1}{{{\color{monokailight-number}1}}}1
        {2}{{{\color{monokailight-number}2}}}1
        {3}{{{\color{monokailight-number}3}}}1
        {4}{{{\color{monokailight-number}4}}}1
        {5}{{{\color{monokailight-number}5}}}1
        {6}{{{\color{monokailight-number}6}}}1
        {7}{{{\color{monokailight-number}7}}}1
        {8}{{{\color{monokailight-number}8}}}1
        {9}{{{\color{monokailight-number}9}}}1,
    % 版面設定
    breaklines=true,
    breakatwhitespace=false,
    captionpos=b,
    keepspaces=true,
    numbers=left,
    numbersep=8pt,
    showspaces=false,
    showstringspaces=false,
    showtabs=false,
    tabsize=4,
    % 框線設定
    frame=single,
    rulecolor=\color{monokailight-border},
    framerule=0.8pt,
    % 其他設定
    columns=flexible,
    escapeinside={(*@}{@*)},
    xleftmargin=2em,
    xrightmargin=0.5em,
    framexleftmargin=1.5em
}

% ========== 設為預設樣式 ==========
\lstset{style=monokailight}
%14.
% ========== 表格樣式設定 ==========
\setlength{\arrayrulewidth}{0.5pt}  % 表格線條粗細
\renewcommand{\arraystretch}{1.3}   % 行高
%15listing 設定:
\lstset{
  language=C++,
  basicstyle=\ttfamily\small,
  numbers=left,
  numberstyle=\tiny,
  stepnumber=1,
  numbersep=8pt,
%
  keepspaces=true,      % ★保留空白
  showspaces=false,
  showstringspaces=false,
  showtabs=false,
%
  tabsize=2,            % ★tab 視為 2 個空白（可改 4）
  breaklines=true,
  breakatwhitespace=false,
%
  frame=single,
  captionpos=b
}



\begin{document}
\maketitle
\tableofcontents
\newpage
\section{前言}
\noindent 由速度空間離散化波茲曼方程：
\begin{equation}\begin{aligned}\label{eq:1}
\frac{\partial f_{i}}{\partial t} (\vec{r}  , t) + \vec{e}_{i}\cdot \frac{\partial f_{i}}{\partial \vec{r}}(\vec{r}  , t)  = \Omega(f_{i}  , f_{i}^{eq})
\end{aligned}\end{equation}
定義濾波變換：
\begin{equation}\begin{aligned}
\mathcal{L} (f) = \int_{\Omega} f(\vec{r}) G(\vec{r} - \vec{r}^{'}) dr^{3}
\end{aligned}\end{equation}
\noindent 對\eqref{eq:1}上式兩側左右同取濾波變換，則有：
\begin{equation}\begin{aligned}\label{eq:2}
\frac{\partial \mathcal{L} (f_{i})}{\partial t} (\vec{r}  , t) + \vec{e}_{i}\cdot \frac{\partial \mathcal{L} (f_{i})}{\partial \vec{r}}(\vec{r}  , t)  = \mathcal{L} \left(\Omega(f_{i}  , f_{i}^{eq})\right)
\end{aligned}\end{equation}
上式\eqref{eq:2}即稱為濾波型速度空間離散化波茲曼方程，對上式\eqref{eq:2}進行時空離散化，則有：
\begin{equation}\begin{aligned}
  \mathcal{L}(f_{i})(\vec{r} + \vec{e}_{i}\delta t , t+ \delta t) = \mathcal{L}(f_{i}) (\vec{r} ,t) + \mathcal{L} (\Omega(f_{i} - f_{i}^{eq})) \delta t
\end{aligned}\end{equation}
\noindent 上式即稱為濾波型晶格波茲曼方程。
\section{亞格子模型與濾波}
\noindent 何謂亞格子應力張量模型？在紊流裡面，最需要關心的雷諾應力張量場 (Raynolds Stress Tensor)，在LES模擬中，為亞格子應力張量場(subgrid stress tensor)，其表達式為：
\begin{equation}\begin{aligned}
  \tau_{ij} &= R_{ij} + C_{ij} + L_{ij} \\[1.5ex]
  &= \left(\overline{u^{'}u^{'}} \right)+ \left( \overline{\overline{u}u^{'}}  + \overline{u^{'}\overline{u}} \right) + \left(\overline{\overline{u}\overline{u}} - \overline{u}\cdot\overline{u}\right) + \overline{u}\cdot\overline{u}
 \end{aligned}\end{equation}
\noindent 其中，$R_{ij}$為亞格子雷諾應力張量場，由此延伸，亞格子應力張量場的一種近似：(S(R(D亞格子應力張量場)的(各向異性部分))的(Smagorinsky模型))。如下給出該應力模型的定義：
\begin{equation}\begin{aligned}
  \tau_{ij} = -2\nu_{t}\overline{S_{ij}} = -2\left(C_s\Delta^{2}\sqrt{2\overline{S_{ij}}\overline{S_{ij}}}\right)\overline{S_{ij}}
\end{aligned}\end{equation}
\noindent 其中，$\overline{S_{ij}} = \frac{1}{2}\left(\frac{\partial \overline{u_{j}}}{\partial x_{i}} + \frac{\partial \overline{u_{i}}}{\partial x_{j}}\right)$，$\nu_{t}$稱為“渦黏度場”(Eddy viscosity)。
在Subgrid turbulance model中，真正的意義為對於“亞格子應力張量場”取(R(D亞格子應力張量場)的(Smagorinsky模型)) ; 同時，對“運動黏度係數場”取為(U(R運動黏滯係數場)的(Smagorinsky模型)) : 
\begin{equation}\begin{aligned}
    \nu_{s} = \nu_{o} + C_{s}\Delta^{2}\sqrt{2\overline{S_{ij}}\cdot\overline{S_{ij}}}
\end{aligned}\end{equation}
如上所示，該模型為空間座標的函數，為原來運動粘滯係數場在LES當中的修正。
在Large Eddy Simulation中，濾波型動量方程組為
\begin{equation}\begin{aligned}
  &\frac{\partial \overline{u_{i}}}{\partial x_{i}} = 0 \\[1.5ex]
  &\frac{\partial \overline{u_{i}}}{\partial t} + \frac{\partial \overline{u_{i}}\cdot \overline{u_{j}}}{\partial x_{i}} = - \frac{1}{\overline{\rho}}\frac{\partial \overline{p}}{\partial x_{i}} - \frac{\partial \tau_{ij}}{\partial x_{i}} + \frac{\partial }{\partial x_{i}} \left(\nu \left(\frac{\partial \overline{u_{j}}}{\partial x_{i}}+\frac{\partial \overline{u_{i}}}{\partial x_{j}}\right)\right)
\end{aligned}\end{equation}
那我們在LBM當中，應該關心的問題是要如何修正Lattice Boltzmann Equation，才能恢復對應到濾波型Navier-Stokes方程組，如下給出一般碰撞算符下的LBE與單鬆弛時間下的LBE:
\begin{equation}\begin{aligned}
&f_{i}(\vec{r}+\vec{e}_{i}\delta t , t+\delta t) = f_{i}(\vec{r}, t)  + \Omega_{i}\\[1.5ex]
&f_{i}(\vec{r}+\vec{e}_{i}\delta t , t+\delta t) = f_{i}(\vec{r}, t)  + \frac{1}{\tau}\left(f_{i}(\vec{r} , t) - f_{i}^{eq}(\rho , \vec{u})\right)\\[1.5ex]
\end{aligned}\end{equation}
同時對上式左右兩側取濾波卷積，則有(E濾波型晶格波茲曼方程)與(R濾波型單鬆弛時間晶格波茲曼方程)：
\begin{equation}\begin{aligned}
&\overline{f_{i}(\vec{r}+\vec{e}_{i}\delta t , t+\delta t)} = \overline{f_{i}(\vec{r}, t)}  + \overline{\Omega_{i}}\\[1.5ex]
&\overline{f_{i}(\vec{r}+\vec{e}_{i}\delta t , t+\delta t)} = \overline{f_{i}(\vec{r}, t)}  + \frac{1}{\tau}\left(\overline{f_{i}(\vec{r} , t)} - \overline{f_{i}^{eq}(\rho , \vec{u}})\right)\\[1.5ex]
\end{aligned}\end{equation}
\noindent 在這邊．文獻所採取的方法為 
\begin{enumerate}
\item (G(T(E一般態分佈函數)且(F平衡態分佈函數)的(碰撞修正項))的(濾波卷積))改為(A(e(E一般態分佈函數)的(濾波卷積))且(f(F平衡態分佈函數)的(濾波卷積))的(碰撞修正項))：
\begin{equation}\begin{aligned}
\text{先娶碰撞再取濾波} &\Rightarrow \text{先取濾波再次取碰撞}\\[1.5ex]
\overline{\Omega_{i}(f(\vec{r},t),f_{i}^{eq}(\rho , \vec{u}))} &\Rightarrow \Omega_{i}(\overline{f(\vec{r},t)},\overline{f_{i}^{eq}(\rho , \vec{u})})
\end{aligned}\end{equation}
\item (f(F平衡態分佈函數)的(濾波卷積)) 取為 
\begin{equation}\begin{aligned}
\overline{f_{i}^{eq}(\rho , \vec{u})} \Rightarrow f_{i}^{eq}(\overline{\rho} , \overline{\vec{u}}) 
\end{aligned}\end{equation}
\end{enumerate}
\noindent 因此，以濾波速度場為自變數的平衡態分佈函數為 
\begin{equation}\begin{aligned}
  f_{i}(\overline{\rho}\, \overline{\vec{u}}) = w_{i}\overline{\rho} \left(1 + \frac{c_{i\alpha}\overline{u_{\alpha}}}{c_{s}^{2}} + \frac{(\overline{u_{\alpha}} \cdot \overline{u_{\beta}})(c_{i\alpha}c_{i\beta} - c_{s}^{2}\delta_{\alpha \beta})}{2c_s^{4}}\right)
\end{aligned}\end{equation}
\subsection{非封閉問題}
\noindent 如果我沒有一點修正，則該濾波型晶格波茲曼方程的解的濾波形式不見得為原晶格波茲曼方程的解：
\begin{equation}\begin{aligned}
  \mathcal{F} \rightarrow \overline{}....  
\end{aligned}\end{equation}
就算你做了第一點修正，形成如下濾波型晶格波茲曼方程：
\\令濾波變換為 ：
\begin{equation}\begin{aligned}
  \mathcal{L}(f) =  \int f(\vec{r}) G(\vec{r} , \vec{r}^{'}) dr^{3}
\end{aligned}\end{equation}

\end{document}

